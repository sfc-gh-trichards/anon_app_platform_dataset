name: paid_app_platform_anon
description: Usage data for a paid-app platform where developers publish apps and customers view them. Charges accrue per view-time and amount spent.

tables:
  - name: anon_views
    description: One row per individual app view (all IDs anonymized).
    base_table:
      database: ANON
      schema: TEMP_SCHEMA
      table: anon_views
    dimensions:
      - name: APP_ID
        expr: APP_ID
        data_type: VARCHAR
      - name: USER_ID
        expr: USER_ID
        data_type: NUMBER(38,0)
      - name: COMPANY_ID
        expr: COMPANY_ID
        data_type: VARCHAR
      - name: STATUS
        expr: STATUS
        data_type: VARCHAR
    time_dimensions:
      - name: VIEW_TIME
        expr: VIEW_TIME
        data_type: TIMESTAMP_NTZ
      - name: VIEW_DATE
        expr: VIEW_DATE
        data_type: DATE
    facts:
      - name: TOTAL_VIEW_TIME_SEC
        expr: TOTAL_VIEW_TIME
        data_type: FLOAT
      - name: TOTAL_AMOUNT_SPENT
        expr: TOTAL_AMOUNT_SPENT
        data_type: FLOAT
      - name: VIEW_COUNT
        expr: 1
        data_type: NUMBER(18,0)
        default_aggregation: SUM

  - name: anon_user_day_fact
    description: Daily roll-up of each user’s activity and spend.
    base_table:
      database: ANON
      schema: TEMP_SCHEMA
      table: anon_user_day_fact
    dimensions:
      - name: USER_ID
        expr: USER_ID
        data_type: NUMBER(38,0)
      - name: COMPANY_ID
        expr: COMPANY_ID
        data_type: VARCHAR
      - name: STATUS
        expr: STATUS
        data_type: VARCHAR
    time_dimensions:
      - name: VIEW_DATE
        expr: VIEW_DATE
        data_type: DATE
    facts:
      - name: TOTAL_AMOUNT_SPENT
        expr: TOTAL_AMOUNT_SPENT
        data_type: FLOAT
      - name: TOTAL_VIEW_TIME_SEC
        expr: TOTAL_VIEW_TIME
        data_type: FLOAT
      - name: DISTINCT_APP_COUNT
        expr: APP_COUNT
        data_type: NUMBER(18,0)
      - name: VIEW_COUNT
        expr: VIEW_COUNT
        data_type: NUMBER(18,0)

  - name: anon_company_day_fact
    description: Daily roll-up of each company’s usage and spend.
    base_table:
      database: ANON
      schema: TEMP_SCHEMA
      table: anon_company_day_fact
    dimensions:
      - name: COMPANY_ID
        expr: COMPANY_ID
        data_type: VARCHAR
      - name: STATUS
        expr: STATUS
        data_type: VARCHAR
    time_dimensions:
      - name: VIEW_DATE
        expr: VIEW_DATE
        data_type: DATE
    facts:
      - name: TOTAL_AMOUNT_SPENT
        expr: TOTAL_AMOUNT_SPENT
        data_type: FLOAT
      - name: TOTAL_VIEW_TIME_SEC
        expr: TOTAL_VIEW_TIME
        data_type: FLOAT
      - name: DISTINCT_APP_COUNT
        expr: APP_COUNT
        data_type: NUMBER(18,0)
      - name: VIEW_COUNT
        expr: VIEW_COUNT
        data_type: NUMBER(18,0)
      - name: DISTINCT_USER_COUNT
        expr: USER_COUNT
        data_type: NUMBER(18,0)
